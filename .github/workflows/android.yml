name: Android CI

on: [push]

jobs:
  build:
    runs-on: ubuntu-18.04
    env:
      ANDROID_SDK_TOOLS:    "4333796"
      ANDROID_CMAKE:        "3.10.2.4988404"
    steps:
      - uses: actions/checkout@v1
      - name: set up JDK 1.8
        uses: actions/setup-java@v1
        with:
          java-version: 1.8
      - name: Install Android sdkmanager
        run: |
          wget --quiet --output-document=android-sdk.zip https://dl.google.com/android/repository/sdk-tools-linux-${ANDROID_SDK_TOOLS}.zip
          sudo unzip -d $ANDROID_HOME android-sdk.zip > /dev/null
      - name: Install required Android tools
        run: |
          echo "y" | sudo $ANDROID_HOME/tools/bin/sdkmanager "ndk;${ANDROID_NDK}" > /dev/null
      - name: Build with Gradle
        run: |
          export PATH="$ANDROID_HOME/cmake/${ANDROID_CMAKE}/bin:$PATH"
          ./gradlew clean build test assembleDebug connectedDebugAndroidTest

  - name: Android Emulator Runner
    uses: ReactiveCircus/android-emulator-runner@v1.0.2
    with:
      # API level of the platform and system image - e.g. 23 for Android Marshmallow, 29 for Android 10
      api-level: 23
      # target of the system image - default or google_apis
      target: # optional, default is default
      # CPU architecture of the system image - x86 or x86_64
      arch: # optional, default is x86
      # Hardware profile used for creating the AVD - e.g. `Nexus 6`.
      #profile: # optional
      # whether to launch emulator in without UI - true or false
      headless: # optional, default is true
      # whether to disable animations - true or false
      disable-animations: # optional, default is true
      # custom script to run - e.g. `./gradlew connectedCheck`
      script: ./gradlew connectedCheck